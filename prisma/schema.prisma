generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["driverAdapters"]
}

datasource db {
  provider = "postgresql"
}

enum Role {
  ADMIN
  STAFF
}

enum PermissionResource {
  RESERVATION
  CUSTOMER
  PAYMENT
  REPORT
}

enum PermissionAction {
  CREATE
  READ
  UPDATE
  DELETE
}

model User {
  id          Int          @id @default(autoincrement())
  firstName   String
  lastName    String
  username    String       @unique
  email       String       @unique
  phoneNumber String
  password    String
  role        Role         @default(STAFF)
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt
  permissions Permission[]
  sessions    Session[]

  @@map("users")
}

model Permission {
  id        Int               @id @default(autoincrement())
  user      User              @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId    Int
  resource  PermissionResource
  action    PermissionAction
  createdAt DateTime          @default(now())
  updatedAt DateTime          @updatedAt

  @@unique([userId, resource, action])

}

model Session {
  id           Int      @id @default(autoincrement())
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId       Int
  refreshToken String   @unique
  createdAt    DateTime @default(now())
  expiresAt    DateTime
  revokedAt    DateTime?
}
